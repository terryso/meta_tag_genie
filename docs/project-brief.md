# Project Brief: 元标记精灵 (MetaTag Genie)

## 1. 项目名称 (Project Name):
元标记精灵 (MetaTag Genie)

## 2. 简介 / 问题陈述 (Introduction / Problem Statement):
许多用户发现，仅仅依靠文件名来搜索和管理本地图片库（尤其是在 Mac 等设备上）效率低下且功能有限。用户希望能够为图片添加更丰富的元数据，如自定义标签、详细描述、涉及的人物和具体的拍摄地点，并通过这些元数据快速准确地找到所需图片。然而，手动编辑这些元数据费时费力，且缺乏智能工具辅助。

‘元标记精灵 (MetaTag Genie)’旨在解决这一问题，提供一个便捷的解决方案，允许用户（理想情况下通过与 AI 开发代理如 Cursor 集成）高效地为图片添加和修改元数据。初期版本将专注于在 macOS 上实现此功能，目标是让用户能够通过系统原生搜索（如 Spotlight）利用这些丰富的元数据进行图片检索，从而极大提升图片管理和查找效率。同时，该工具写入的描述信息，根据初步研究，未来有潜力在 iPhone 照片应用中也被搜索到。

## 3. 愿景与目标 (Vision & Goals)

* **愿景 (Vision):**
    赋予用户强大而智能的本地图片库元数据管理能力，最终实现轻松的图片组织和便捷的跨设备搜索体验，让每一张珍贵图片都能被快速发现和利用。
* **主要目标 (Primary Goals - 针对 MVP):**
    1.  **工具开发:** 开发一个在 macOS 上运行的工具或 MCP (Model Context Protocol) 服务，该工具能够接收指定的图片路径以及结构化的元数据（包括标签、描述、人物名称、地点信息）。
    2.  **元数据写入:** 该工具需能成功将接收到的结构化元数据准确写入图片文件的标准元数据字段中（如 EXIF, IPTC, XMP）。计划在 \[例如：未来4周内] 完成核心写入功能的开发和测试。
    3.  **macOS 搜索验证:** 成功验证经由该工具修改过的图片，可以在 macOS Spotlight 搜索中，通过至少三种不同的新增元数据类型（例如：一个特定的标签、描述中的一个关键词、作为标签写入的人物名称）被有效检索。
    4.  **技术实践:** 项目核心代码采用 TypeScript 语言开发，并遵循 TDD (测试驱动开发) 原则，目标测试覆盖率达到 \[例如：80%]。
* **成功指标 (Success Metrics - MVP 的初步想法):**
    1.  **写入成功率:** 对于主流图片格式（如 JPG, PNG, HEIC），所有指定类型的元数据写入操作成功率达到 95% 以上。
    2.  **元数据可读性:** 由本工具写入的所有元数据字段，均能通过标准元数据查看工具（如 ExifTool）正确读取和显示。
    3.  **Spotlight 检索有效性:** 测试用户能够通过 Spotlight 搜索，在 \[例如：5秒内] 找到超过 90% 的已添加新元数据的测试图片。
    4.  **(延伸验证)** 工具写入的“描述 (Description)”元数据，在图片导入 iPhone 照片应用后，能够被正确显示。（iPhone 上的可搜索性作为 MVP 阶段的一个加分验证项）。

## 4. 目标用户 / 用户画像 (Target Audience / Users)
‘元标记精灵 (MetaTag Genie)’ 的主要目标用户是：

* **Mac 用户：** 他们在 macOS 环境下工作和管理自己的数字资产。
* **拥有本地图片库：** 他们在本地存储了相当数量的图片（个人照片、工作素材、收藏等），并希望对其进行有效管理。
* **对现有搜索不满：** 他们觉得仅通过文件名或简单的日期进行图片搜索无法满足需求，渴望更精细、基于内容的检索方式。
* **追求高效管理：** 他们希望通过添加自定义标签、详细描述、人物和地点等元数据来更好地组织图片，以便快速查找。
* **潜在用户类型：** 可能包括摄影爱好者、设计师、内容创作者、研究人员，或任何需要高效管理大量本地数字图片集的个人或专业人士。
* **技术接受度：** 他们通常对新技术有一定的接受能力，并且可能对 AI 辅助工作流程（如通过 Cursor 等工具进行元数据建议和编辑）抱有兴趣。

## 5. 关键特性 / 产品范围 (Key Features / Scope - MVP 的高阶构想)

1.  **元数据写入服务 (macOS):**
    * 开发一个核心服务/工具，作为 macOS 上的 MCP (Model Context Protocol) 服务器或一个可被 AI 代理调用的命令行工具。
    * **输入能力:**
        * 接收指定图片的本地文件路径。
        * 接收结构化的元数据输入，至少包括：
            * **标签/关键词 (Tags/Keywords):** 一组文本标签。
            * **描述 (Description):** 一段详细的文本描述。
            * **人物名称 (People):** 一组人物名称（MVP阶段可能作为关键词写入，或研究写入到特定易被Spotlight索引的XMP字段）。
            * **地点信息 (Location):** 文本型地点描述或更结构化的地理坐标（需确定目标EXIF/XMP字段）。
    * **处理能力:**
        * 能够读取常见的图片文件格式 (如 JPG, PNG, HEIC)。
        * 将接收到的结构化元数据写入图片文件对应的标准元数据字段中 (例如，使用 IPTC Keywords 存放标签，使用 XMP Description 或 IPTC Caption 存放描述，使用 EXIF GPS 存放地理坐标等)。
    * **输出能力:**
        * 输出修改元数据后的图片文件（具体是覆盖原文件还是生成新文件，可在后续PRD中定义）。
2.  **Spotlight 搜索集成验证:**
    * 确保经过上述服务处理并添加了元数据的图片，能够在 macOS 的 Spotlight 搜索中通过新添加的元数据（如标签、描述中的词语、人物名称关键词）被有效检索到。
3.  **(概念性) AI 代理集成点:**
    * 该工具的设计应考虑到未来能被 AI 开发代理（如 Cursor）调用。AI 代理负责分析图片内容并提供结构化的元数据给本工具进行写入。
    * *MVP 简化：* 在 MVP 阶段，提供给本工具的结构化元数据可以先通过手动构造的输入或简化的模拟 AI 输出来实现，以便集中测试核心的元数据写入和读取功能。

## 6. 已知技术限制或偏好 (Known Technical Constraints or Preferences)

* **限制与偏好 (Constraints & Preferences):**
    1.  **编程语言:** TypeScript (根据用户偏好)。
    2.  **开发流程:** TDD (测试驱动开发) (根据用户偏好)。
    3.  **目标平台 (MVP):** macOS。
    4.  **系统架构 (初步设想):** 考虑设计为一个 MCP (Model Context Protocol) 服务器或一个命令行工具，以便能被 AI 开发代理（如 Cursor）调用。
    5.  **元数据标准:** 需要兼容并正确读写标准的图片元数据格式，如 EXIF, IPTC, XMP，以确保与 macOS Spotlight 及其他图片工具的兼容性。
    6.  **图片格式支持:** MVP 阶段至少需要支持常见的图片格式，如 JPEG, PNG。对 HEIC 格式的支持也应考虑（HEIC 是苹果设备默认格式）。
    7.  **AI 集成接口 (MVP 概念):** 工具应设计清晰的接口来接收结构化的元数据输入（来自 AI 分析或手动输入）。MVP 阶段，此输入可简化处理，但接口需明确。
    8.  **数据存储 (MVP):** 元数据直接写入图片文件本身，MVP 阶段不引入外部数据库。
    9.  **时间/预算:** \[待定]
* **风险 (Risks):**
    1.  **元数据写入的复杂性:**
        * 在多种图片格式 (JPG, PNG, HEIC) 及其不同的元数据标准 (EXIF, IPTC, XMP) 之间，确保所有目标元数据类型（标签、描述、人物、地点）都能被一致、正确地写入，可能存在技术挑战。不同的库对标准的支持程度和行为细节可能不同。
        * 在写入操作过程中，需要避免损坏图片文件或丢失已有的重要元数据。
    2.  **Spotlight 索引的可靠性与即时性:**
        * 虽然 Spotlight 通常会索引标准元数据，但对于我们写入的*所有特定字段*（尤其是“人物”信息如果仅作为通用关键词存储），其索引的完整性、准确性和更新即时性需要充分验证。
        * 需要确保所选的元数据字段和格式能被 Spotlight 最有效地识别和用于搜索。
    3.  **“人物”元数据的处理方式:**
        * 如何以通用且有效的方式存储“人物”名称并使其可被 Spotlight 搜索，需要仔细考虑。简单作为关键词存储可能缺乏结构，而使用特定的 XMP 人物区域标签可能增加实现复杂度，且不一定能被 Spotlight 的通用关键词搜索到。
    4.  **对外部 AI 代理的依赖 (完整愿景):**
        * 项目的完整愿景部分依赖于 AI 代理（如 Cursor）来提供结构化的元数据。这类代理的可用性、能力和接口稳定性可能成为实现完整项目愿景的风险。
    5.  **范围蔓延:**
        * 考虑到未来可能希望支持更多元数据类型、图片格式或更深度的 AI 集成，需要警惕 MVP 阶段发生范围蔓延的风险。
    6.  **iPhone “描述”可搜索性的最终验证:**
        * 尽管研究表明“描述”元数据在 iPhone 上有潜力被搜索，但这仍需在实际导入和测试后最终确认，苹果系统行为可能发生变化。

## 7. 相关研究 (Relevant Research - 可选)
针对本项目的核心需求之一——修改后的图片元数据在设备上的可搜索性——我们进行了一项初步研究，主要聚焦于 iPhone 原生照片 App 如何处理和索引外部修改的嵌入式图片元数据（包括标签、描述、人物、地点）。

* **主要研究发现：**
    * **“描述/说明 (Captions/Descriptions)”元数据最具潜力：** 如果“描述”信息被正确写入并被 iPhone 照片 App（尤其是在通过 iCloud 照片图库同步时）识别为“说明”，则其在 iPhone 上具有较高的可搜索性。
    * **自定义“标签/关键词”和非苹果系统“人物”标签的搜索局限性：** 研究表明，iPhone 原生照片 App 对用户通过外部工具添加的任意“标签/关键词”或自定义的“人物”标签（非苹果系统自身的人物识别）的搜索支持不明确，且可能性较低。
    * **苹果 AI 驱动搜索：** iPhone 照片 App 的强大搜索功能（如物体、场景识别）主要依赖其自身的 AI 技术，而非仅仅依赖嵌入的文本元数据标签。
    * **标准 EXIF 数据的良好支持：** 日期、GPS 等标准 EXIF 元数据通常能得到良好支持和利用。
* **研究结论对 MVP 的影响：**
    此研究结果强调了在 Mac 端实现全面的元数据写入和 Spotlight 搜索是完全可行的。对于 iPhone 端，虽然所有写入的元数据都会随图片文件保留，但原生照片 App 的搜索功能可能主要对“描述/说明”和标准 EXIF 数据有效，而其他自定义标签的直接搜索效果有待进一步的实际验证。因此，MVP 将首先确保 Mac 端的强大功能和可搜索性。

---

## 8. PM Prompt (给产品经理的提示)

以下是为产品经理 (PM) 准备的提示，旨在帮助他们基于此项目简章启动产品需求文档 (PRD) 的创建过程：

**项目名称：元标记精灵 (MetaTag Genie)**

**A. 核心洞察与项目摘要:**
“元标记精灵 (MetaTag Genie)” 项目旨在为 macOS 用户提供一个高效的工具（MVP阶段），用于向本地图片文件写入丰富的元数据（标签、描述、人物、地点），以显著改善通过 Spotlight 进行的本地图片搜索体验。当前用户痛点是仅靠文件名难以有效查找图片。MVP 将专注于在 macOS 上通过 TypeScript 和 TDD 实现一个核心的元数据写入服务（可能作为 MCP 服务或命令行工具），并验证其与 Spotlight 的集成效果。长远愿景包括与 AI 开发代理（如 Cursor）集成以实现元数据的智能建议与填充，并期望写入的“描述”信息能在 iPhone 上也被搜索到。

**B. PRD 中需特别关注的领域:**

1.  **元数据字段精确映射:**
    * 详细定义每种元数据类型（标签、描述、人物、地点）将映射到哪些具体的标准 EXIF, IPTC, XMP 字段。
    * 研究并确定最佳实践，以确保 Spotlight 的最大化索引效率和跨工具的兼容性。
2.  **“人物”元数据存储策略:**
    * 明确 MVP 阶段如何存储“人物”名称（例如，作为通用关键词，还是尝试写入特定的 XMP 人物标签）。
    * 评估不同策略对 Spotlight 搜索效果及实现复杂度的影响。
3.  **图片格式支持细节:**
    * 明确 MVP 支持的图片格式列表 (JPG, PNG 必选，HEIC 建议)。
    * 针对每种格式，确认元数据读写的具体库和方法，以及潜在的兼容性问题。
4.  **错误处理与用户反馈机制:**
    * 设计健壮的错误处理机制，覆盖文件操作失败、不支持的图片格式、元数据写入冲突或失败等情况。
    * 明确工具（无论是 MCP 服务还是 CLI）将如何向调用者（AI 代理或用户）提供操作成功或失败的反馈。
5.  **MVP 的用户交互接口:**
    * 如果作为 MCP 服务，定义清晰的服务接口、请求和响应格式（例如，使用 JSON）。
    * 如果作为命令行工具，定义详细的命令、参数和选项。
6.  **Spotlight 集成测试方案:**
    * 制定系统的测试计划，以验证不同元数据组合和图片类型在 Spotlight 中的索引情况和搜索效果。
    * 包括对索引延迟的考量。

**C. 开发背景与上下文:**

* 该项目源于用户提升本地图片搜索效率的实际需求。
* 在初步构思后，针对 iPhone 端元数据搜索的可行性进行了研究，从而确定了 MVP 以 macOS 为核心的策略。
* 用户对技术有一定理解，并对最终与 AI 代理集成表现出明确兴趣。
* 强调直接修改图片文件元数据，MVP 阶段不引入独立数据库。

**D. PRD 详细程度指南:**

* 为核心的元数据写入功能（针对每种类型：标签、描述、人物、地点）提供详细的用户故事和验收标准。
* 明确定义 Spotlight 搜索的成功标准（例如，“用户可以通过标签 X 找到图片 Y”）。
* 详细描述工具的输入（图片路径、结构化元数据对象）和预期输出（修改后的图片文件状态、操作结果反馈）。
* 鼓励对 TypeScript 中可用的元数据处理库进行调研，并分析其优缺点。
* 对于 MCP 服务接口，需要详细定义其契约。

**E. 用户关键偏好:**

* **技术栈:** 强制使用 TypeScript 进行开发。
* **开发方法:** 严格遵循 TDD (测试驱动开发) 原则。
* **平台焦点 (MVP):** 专注于 macOS。
* **架构考量:** 设计上应为未来与 AI 开发代理（如 Cursor）的集成预留接口或可能性。
* **数据存储:** 直接在图片文件中读写元数据。